*** Settings ***
Documentation     This is high level keywords that will be used by local test cases
Resource          messages.txt
Resource          context.txt
Library           com.automic.robot.itpa.ItpaLibrary

*** Key Words ***
Suite Setup
    Action Connect    ${_AE_HOST}    ${_AE_PORT}    ${_AE_USER}    ${_AE_PASS}    ${_AE_TEMP_FOLD}
    Init Server
    Download datatest    /testdata/PCK.AUTOMIC_ORACLE

Download datatest
    [Arguments]    ${path}
    Action Connect    ${_AE_HOST}    ${_AE_PORT}    ${_AE_USER}    ${_AE_PASS}    ${_AE_TEMP_FOLD}
    Init Action    PCK.AUTOMIC_FTP.PUB.ACTION.GET
    Action Set    &UC4RB_FTP_HOST#    vvni01
    Action Set    &UC4RB_FTP_USER#    administrator
    Action Set    &UC4RB_FTP_PWD#    S3rv3r@Aut
    Action Set    &UC4RB_FTP_TGT_OVERWRITE#    YES
    Action Set    &UC4RB_FTP_SOURCE_FILES#    ${path}
    Action Set    &UC4RB_FTP_TGT_FILES_DIR#    ${_WORKING_DIR}
    Action Set    &UC4RB_FTP_RECURSIVE_GET#    YES
    Action Set    &UC4RB_FTP_PROTOCOL#    FTP
    Action Set    &UC4RB_FTP_CONNECT_TIMEOUT#    5000
    Action Set    &UC4RB_FTP_TR_MODE#    BINARY
    Action Execute

Init Action
    [Arguments]    ${actionName}
    Action Create    ${actionName}
    Action Set    ${PROMPTSET_AGENT}    ${_AGENT}
    Action Set    ${PROMPTSET_LOGIN}    ${_LOGIN}

Action Report Should Contain
    [Arguments]    ${text}
    ${report} =    Action Get Report
    Should Contain    ${report}    ${text}

Action Report Should Be Found
    ${report} =    Action Get Report
    Should Not Be Empty    ${report}

Action Report Should Not Be Found
    ${report} =    Action Get Report
    Should Be Empty    ${report}

Action Return Code Should Be
    [Arguments]    ${code}
    ${returnCode}=    Action Get Variable    Return code
    Should Be Equal    ${returnCode}    ${code}

Action Return Code Should Not Equal
    [Arguments]    ${code}
    ${returnCode}=    Action Get Variable    Return code
    Should Not Be Equal    ${returnCode}    ${code}

Action Return Status Should Be
    [Arguments]    ${status}
    ${returnStatus}=    Action Get Variable    Status
    Should Be Equal    ${returnStatus}    ${status}

Action Return Variable Should Be
    [Arguments]    ${variableValue}
    ${out}=    Action Get Variable    ${variableName}
    Should Be Equal    ${out}    ${variableValue}

Action Return Variable Should Be Equal As Integers
    [Arguments]    ${variableValue}
    ${out}=    Action Get Variable    ${variableName}
    Should Be Equal As Integers    ${out}    ${variableValue}

Oracle Common Setting
    Action Set    ${PRT_CREATE_USER_DB_USERNAME_LG}    ${DB_USERNAME}
    Action Set    ${PRT_CREATE_USER_DB_PASSWORD_LG}    ${DB_PASSWORD}
    Action Set    ${PRT_CREATE_USER_DB_JDBC_CONN_STRING}    ${CONN_STRING}
    Action Set    ${PRT_CREATE_USER_DB_DRIVER_JAR}    ${JAR}
    Action Set    ${PRT_CREATE_USER_DB_DRIVER_CLASS}    ${CLASS}
    Action Set    ${PRT_CREATE_USER_DB_TNSNAMES_ORA}    ${ORA}
    Action Set    ${PRT_CREATE_USER_DB_CONN_INTRVL}    ${INTRVL}

Create User
    [Arguments]    ${name}    ${externally}    ${globally}    ${password_expire}    ${account_lock}    ${id}
    Init Action    ${ACTION_CREATE_USER}
    Action Set    ${PRT_CREATE_USER_DB_USERNAME_LG}    ${DB_USERNAME}
    Action Set    ${PRT_CREATE_USER_DB_PASSWORD_LG}    ${DB_PASSWORD}
    Action Set    ${PRT_CREATE_USER_DB_JDBC_CONN_STRING}    ${CONN_WITHOUTSID}${id}
    Action Set    ${PRT_CREATE_USER_DB_DRIVER_JAR}    ${JAR}
    Action Set    ${PRT_CREATE_USER_DB_DRIVER_CLASS}    ${CLASS}
    Action Set    ${PRT_CREATE_USER_DB_TNSNAMES_ORA}    ${ORA}
    Action Set    ${PRT_CREATE_USER_DB_CONN_INTRVL}    ${INTRVL}
    Action Set    &UC4RB_DB_USER_NAME#    ${name}
    Action Set    ${PRT_CREATE_USER_DB_FAIL_USR_EXISTS}    NO
    Action Set    ${PRT_CREATE_USER_DB_USER_PASSWORD}    ${DB_PASSWORD}
    Action Set    ${PRT_CREATE_USER_DB_IDTFT_EXTERNALLY}    ${externally}
    Action Set    ${PRT_CREATE_USER_DB_IDTFT_CERT_DN}    ${EMPTY}
    Action Set    ${PRT_CREATE_USER_DB_IDTFT_GLOBALLY}    ${globally}
    Action Set    ${PRT_CREATE_USER_DB_IDTFT_DIR_DN}    ${EMPTY}
    Action Set    ${PRT_CREATE_USER_DB_DEFAULT_TABLESPACE}    ${EMPTY}
    Action Set    ${PRT_CREATE_USER_DB_TEMP_TABLESPACE}    ${EMPTY}
    Action Set    ${PRT_CREATE_USER_DB_QUOTA_SPEC}    ${EMPTY}
    Action Set    ${PRT_CREATE_USER_DB_PROFILE}    ${EMPTY}
    Action Set    ${PRT_CREATE_USER_DB_PASSWORD_EXPIRE}    ${password_expire}
    Action Set    ${PRT_CREATE_USER_DB_ACCOUNT_LOCK}    ${account_lock}
    Action Execute
    Action Report Should Be Found
    Action Return Code Should Be    0
    Action Return Status Should Be    ${ENDED_OK}

Drop User
    [Arguments]    ${userDrop}
    Init Action    ${ACTION_DROP_USER}
    Oracle Common Setting
    Action Set    ${PRT_DROP_USER_DB_DROP_USER}    ${userDrop}
    Action Set    ${PRT_DROP_USER_DB_FAIL_USR_NOT_EXISTS}    NO
    Action Set    ${PRT_DROP_USER_DB_CASCADE}    YES
    Action Execute
    Action Report Should Be Found
    Action Return Code Should Be    0
    Action Return Status Should Be    ${ENDED_OK}

Drop User With Cascade
    [Arguments]    ${user}
    Init Action    ${ACTION_DROP_USER}
    Oracle Common Setting
    Action Set    ${PRT_DROP_USER_DB_DROP_USER}    ${user}
    Action Set    ${PRT_DROP_USER_DB_FAIL_USR_NOT_EXISTS}    NO
    Action Set    ${PRT_DROP_USER_DB_CASCADE}    YES
    Action Execute

Assign Grant all
    [Arguments]    ${grant_to_user}    ${sys}    ${user}
    Init Action    ${ACTION_ASSIGN_GRANT}
    Oracle Common Setting
    Action Set    ${PRT_ASSIGN_GRANT_DB_GRANT_SYS_PRIVILEGE}    ${EMPTY}
    Action Set    ${PRT_ASSIGN_GRANT_DB_GRANT_OBJ_PRIVILEGE}    ${EMPTY}
    Action Set    ${PRT_ASSIGN_GRANT_DB_GRANT_ROLE_PRIVILEGE}    ${EMPTY}
    Action Set    ${PRT_ASSIGN_GRANT_DB_GRANT_CUST_ROLE_PRVLG}    ${EMPTY}
    Action Set    ${PRT_ASSIGN_GRANT_GRANT_ALL_SYS_PRIVILEGES}    ${sys}
    Action Set    ${PRT_ASSIGN_GRANT_GRANT_ALL_USER_PRVLGS}    ${user}
    Action Set    ${PRT_ASSIGN_GRANT_DB_GRANT_ON_SCHM_OBJ}    ${EMPTY}
    Action Set    ${PRT_ASSIGN_GRANT_DB_GRANT_TO_USER}    ${grant_to_user}
    Action Set    ${PRT_ASSIGN_GRANT_DB_GRANT_TO_ROLE}    ${EMPTY}
    Action Set    ${PRT_ASSIGN_GRANT_DB_GRANT_TO_PUBLIC}    NO
    Action Set    ${PRT_ASSIGN_GRANT_DB_WITH_HIERARCHY_OPTION}    NO
    Action Set    ${PRT_ASSIGN_GRANT_DB_WITH_GRANT_OPTION}    NO
    Action Set    ${PRT_ASSIGN_GRANT_DB_WITH_ADMIN_OPTION}    NO
    Action Execute
    Action Report Should Be Found

Drop TableSpace
    [Arguments]    ${name}
    Init Action    ${ACTION_DROP_TABLESPACE}
    Oracle Common Setting
    Action Set    ${PRT_DROP_TABLESPACE_DB_DROP_TABLESPACE}    ${name}
    Action Set    ${PRT_DROP_TABLESPACE_DB_FAIL_TS_NOT_EXISTS}    NO
    Action Set    ${PRT_DROP_TABLESPACE_DB_DROP_CONTENTS}    YES
    Action Set    ${PRT_DROP_TABLESPACE_DB_DROP_DATAFILES}    YES
    Action Set    ${PRT_DROP_TABLESPACE_DB_CASCADE_CNSTR}    YES
    Action Execute
    Action Report Should Be Found

Import DB
    [Arguments]    ${files}    ${from_users}    ${to_users}    ${tables}    ${owner}    ${tableSpace}
    Init Action    ${ACTION_IMPORT_DB}
    Action Set    ${PRT_IMPORT_DB_DB_USERNAME}    ${DB_USERNAME2}
    Action Set    ${PRT_IMPORT_DB_DB_PASSWORD}    ${DB_PASSWORD}
    Action Set    ${PRT_IMPORT_DB_DB_SID}    ${SID}
    Action Set    ${PRT_IMPORT_DB_DB_IMPOPT_FILES}    ${files}
    Action Set    ${PRT_IMPORT_DB_DB_IMPMODE_FROMUSERS}    ${from_users}
    Action Set    ${PRT_IMPORT_DB_DB_IMPMODE_TOUSERS}    ${to_users}
    Action Set    ${PRT_IMPORT_DB_DB_IMPMODE_TS_LIST}    ${tableSpace}
    Action Set    ${PRT_IMPORT_DB_DB_IMPMODE_TRANSP_TS}    NO
    Action Set    ${PRT_IMPORT_DB_DB_IMPOPT_FILESIZE}    ${EMPTY}
    Action Set    ${PRT_IMPORT_DB_DB_IMPOPT_VOLSIZE}    ${EMPTY}
    Action Set    ${PRT_IMPORT_DB_DB_IMP_INVOKE_AS_SYSDBA}    YES
    Action Set    ${PRT_IMPORT_DB_DB_IMPMODE_FULL}    NO
    Action Set    ${PRT_IMPORT_DB_DB_IMPMODE_TABLES}    ${tables}
    Action Set    ${PRT_IMPORT_DB_DB_IMPMODE_TTS_OWNERS}    ${owner}
    Action Set    ${PRT_IMPORT_DB_DB_IMPMODE_DATAFILES}    ${EMPTY}
    Action Set    ${PRT_IMPORT_DB_DB_IMPOPT_LOGFILE}    YES
    Action Set    ${PRT_IMPORT_DB_DB_IMPOPT_RECORDLENGTH}    0
    Action Set    ${PRT_IMPORT_DB_DB_IMPOPT_ROWS}    YES
    Action Set    ${PRT_IMPORT_DB_DB_IMPOPT_COMMIT}    NO
    Action Set    ${PRT_IMPORT_DB_DB_IMPOPT_BUFFER}    0
    Action Set    ${PRT_IMPORT_DB_DB_IMPOPT_IGNORE_ERR}    YES
    Action Set    ${PRT_IMPORT_DB_DB_IMPOPT_DESTROY}    NO
    Action Set    ${PRT_IMPORT_DB_DB_IMPOPT_CONSTRAINTS}    YES
    Action Set    ${PRT_IMPORT_DB_DB_IMPOPT_STREAMS_CONFIG}    YES
    Action Set    ${PRT_IMPORT_DB_DB_IMPOPT_STREAMS_INST}    NO
    Action Set    ${PRT_IMPORT_DB_DB_IMPOPT_GRANTS}    NO
    Action Set    ${PRT_IMPORT_DB_DB_IMPOPT_STATISTICS}    ALWAYS
    Action Set    ${PRT_IMPORT_DB_DB_IMPOPT_RESUMABLE}    NO
    Action Set    ${PRT_IMPORT_DB_DB_IMPOPT_RESUMABLE_NAME}    ${EMPTY}
    Action Set    ${PRT_IMPORT_DB_DB_IMPOPT_RSMBL_TIMEOUT}    ${EMPTY}
    Action Set    ${PRT_IMPORT_DB_DB_IMPOPT_COMPILE}    YES
    Action Execute
    Action Report Should Be Found

Create Tablespace
    [Arguments]    ${name}
    Drop Tablespace    ${name}
    Init Action    ${ACTION_CREATE_TABLESPACE}
    Oracle Common Setting
    Action Set    ${PRT_CREATE_TABLESPACE_DB_TABLESPACE_NAME}    ${name}
    Action Set    ${PRT_CREATE_TABLESPACE_DB_FAIL_IF_TS_EXISTS}    NO
    Action Set    ${PRT_CREATE_TABLESPACE_DB_TABLESPACE_TYPE}    Undo
    Action Set    ${PRT_CREATE_TABLESPACE_DB_SMALLFILE}    DEFAULT
    Action Set    ${PRT_CREATE_TABLESPACE_DB_LOGGING}    DEFAULT
    Action Set    ${PRT_CREATE_TABLESPACE_DB_FORCE_LOGGING}    DEFAULT
    Action Set    ${PRT_CREATE_TABLESPACE_DB_ONLINE}    YES
    Action Set    ${PRT_CREATE_TABLESPACE_DB_EXT_MGMT_CLAUSE}    Omit
    Action Set    ${PRT_CREATE_TABLESPACE_DB_EXT_MGMT_TYPE}    Local
    Action Set    ${PRT_CREATE_TABLESPACE_DB_EXT_MGMT_AUTOALLOC}    YES
    Action Set    ${PRT_CREATE_TABLESPACE_DB_EXT_MGMT_UNIFORM}    NO
    Action Set    ${PRT_CREATE_TABLESPACE_DB_SEGM_SPC_AUTO}    YES
    Action Set    ${PRT_CREATE_TABLESPACE_DB_RETENTION}    NO
    Action Set    ${PRT_CREATE_TABLESPACE_DB_PERM_DATAFILE_SPEC}    ${EMPTY}
    Action Set    ${PRT_CREATE_TABLESPACE_DB_TEMPFILE_SPEC}    ${EMPTY}
    Action Set    ${PRT_CREATE_TABLESPACE_DB_UNDO_DATAFILE_SPEC}    '${DB_FILE_PATH}${/}test_datafile18.dbs' size 10m
    Action Set    ${PRT_CREATE_TABLESPACE_DB_MIN_EXT_SIZE}    ${EMPTY}
    Action Set    ${PRT_CREATE_TABLESPACE_DB_BLOCK_SIZE}    ${EMPTY}
    Action Set    ${PRT_CREATE_TABLESPACE_DB_TS_GROUP_NAME}    ${EMPTY}
    Action Set    ${PRT_CREATE_TABLESPACE_DB_EXT_UNFRM_MGMT_SIZE}    ${EMPTY}
    Action Set    ${PRT_CREATE_TABLESPACE_DB_DFLT_STRG_CLAUSE}    ${EMPTY}
    Action Execute
    Action Report Should Be Found
    Action Return Code Should Be    0
    Action Return Status Should Be    ${ENDED_OK}

Exec Sqlplus
    [Arguments]    ${service}    ${user}    ${admin_priv}    ${command}
    Init Action    ${ACTION_EXEC_SQLPLUS}
    Action Set    ${PRT_EXEC_SQLPLUS_DB_SERVICE}    ${service}
    Action Set    ${PRT_EXEC_SQLPLUS_DB_HOST}    ${HOST}
    Action Set    ${PRT_EXEC_SQLPLUS_DB_PORT}    1521
    Action Set    ${PRT_EXEC_SQLPLUS_DB_USER}    ${user}
    Action Set    ${PRT_EXEC_SQLPLUS_DB_PASS}    ${DB_PASSWORD}
    Action Set    ${PRT_EXEC_SQLPLUS_DB_USE_ADMIN_PRIV}    ${admin_priv}
    Action Set    ${PRT_EXEC_SQLPLUS_DB_SQLPLUS_FULL_PATH}    ${SQLPLUS_FULL_PATH}
    Action Set    ${PRT_EXEC_SQLPLUS_DB_COMMAND}    ${command}
    Action Execute
    Action Report Should Be Found
    Action Return Code Should Be    0
    Action Return Status Should Be    ${ENDED_OK}
