*** Settings ***
Documentation     NOTE:
...               add note here
Suite Setup       Suite Setup User Assign Import
Default Tags      EXPORT_DB    win11    unix11    unix10    #Suite Teardown    Drop user and tablespace
Test Template     Export Db Template
Resource          ../../resources/keywords.txt

*** Test Cases ***    USERNAME                                               PASSWORD          SID               FILES                     TS_LIST         FILESIZE    VOLSIZE     FULL        OWNER_LIST        TABLE_LIST                     TRANSP_TS    TTS_FULLCHECK    LOGFILE           RECORDLENGTH      COMPRESS    ROWS    DIRECT    STATISTICS    INDEXES     CONSTRAINTS    GRANTS    TRIGGERS    CONSISTENT    OBJ_CONSISTENT    BUFFER    RESUMABLE    RESUMABLE_NAME                                                    RSMBL_TIMEOUT                                                     AS SYSDBA    RETURN CODE    STATUS
Export DB             [Tags]                                                 nowin
                      ${DB_USERNAME}                                         ${DB_PASSWORD}    ${SID}            export1.dmp               ${EMPTY}        ${EMPTY}    ${EMPTY}    NO          ${EMPTY}          ${EMPTY}                       NO           NO               ${EMPTY}          0                 NO          YES     NO        NONE          YES         YES            YES       YES         NO            NO                0         NO           User USERNAME (USERID), Session SESSIONID, Instance INSTANCEID    7200                                                              NO           0              ${ENDED_OK}
                      #Timeout with too large data
                      #Export DB full data, except export mode
                      ${USER_IMPORT}                                         ${DB_PASSWORD}    ${SID}            export0.dmp               ${EMPTY}        4MB         100MB       NO          ${USER_IMPORT}    ${EMPTY}                       NO           NO               testExport.log    2048              NO          YES     NO        ESTIMATE      YES         YES            YES       YES         NO            NO                2048      NO           User USERNAME (USERID), Session SESSIONID, Instance INSTANCEID    7200                                                              NO           0              ${ENDED_OK}
                      #Unstable on grant export privilage for system user
                      #Export DB full export
                      #                                                      system            ${DB_PASSWORD}    ${SID}                    export23.dmp    ${EMPTY}    ${EMPTY}    ${EMPTY}    YES               ${EMPTY}                       ${EMPTY}     NO               NO                testExport.log    2048        NO      YES       NO            ESTIMATE    YES            YES       YES         YES           NO                NO        2048         NO                                                                User USERNAME (USERID), Session SESSIONID, Instance INSTANCEID    7200         YES            0              ${ENDED_OK}

Export DB multi file
                      ${DB_USERNAME}                                         ${DB_PASSWORD}    ${SID}            multi1.dmp,multi2.dmp     ${EMPTY}        16KB        ${EMPTY}    NO          test              ${EMPTY}                       NO           NO               ${EMPTY}          0                 NO          YES     NO        ESTIMATE      YES         YES            YES       YES         NO            NO                0         NO           User USERNAME (USERID), Session SESSIONID, Instance INSTANCEID    7200                                                              NO           0              ${ENDED_OK}

Export DB with table
                      itpa                                                   ${DB_PASSWORD}    ${SID}            export_table.dmp          ${EMPTY}        ${EMPTY}    ${EMPTY}    NO          ${EMPTY}          STAFF                          NO           NO               ${EMPTY}          0                 NO          YES     NO        NONE          YES         YES            YES       YES         NO            NO                0         NO           User USERNAME (USERID), Session SESSIONID, Instance INSTANCEID    7200                                                              NO           0              ${ENDED_OK}

Export DB with table space
                      ${DB_USERNAME}                                         ${DB_PASSWORD}    ${SID}            table_space.dmp           TEST            ${EMPTY}    ${EMPTY}    NO          ${EMPTY}          ${EMPTY}                       NO           NO               ${EMPTY}          0                 NO          YES     NO        ESTIMATE      YES         YES            YES       YES         NO            NO                0         NO           User USERNAME (USERID), Session SESSIONID, Instance INSTANCEID    7200                                                              YES          0              ${ENDED_OK}

Export DB with owner
                      ${DB_USERNAME2}                                        ${DB_PASSWORD}    ${SID}            test.dmp                  ${EMPTY}        ${EMPTY}    ${EMPTY}    NO          ${DB_USERNAME}    ${EMPTY}                       NO           NO               ${EMPTY}          0                 NO          YES     NO        ESTIMATE      YES         YES            YES       YES         NO            NO                0         NO           User USERNAME (USERID), Session SESSIONID, Instance INSTANCEID    7200                                                              YES          0              ${ENDED_OK}

Export DB with multi owner
                      ${DB_USERNAME2}                                        ${DB_PASSWORD}    ${SID}            test_itpa.dmp             ${EMPTY}        ${EMPTY}    ${EMPTY}    NO          test,itpa         ${EMPTY}                       NO           NO               ${EMPTY}          0                 NO          YES     NO        ESTIMATE      YES         YES            YES       YES         NO            NO                0         NO           User USERNAME (USERID), Session SESSIONID, Instance INSTANCEID    7200                                                              YES          0              ${ENDED_OK}

Export DB with multi table
                      itpa                                                   ${DB_PASSWORD}    ${SID}            export_multi_table.dmp    ${EMPTY}        ${EMPTY}    ${EMPTY}    NO          ${EMPTY}          CERTIFICATE,market             NO           NO               ${EMPTY}          0                 NO          YES     NO        ESTIMATE      YES         YES            YES       YES         NO            NO                0         NO           User USERNAME (USERID), Session SESSIONID, Instance INSTANCEID    7200                                                              NO           0              ${ENDED_OK}

Export DB with multi table space
                      ${DB_USERNAME2}                                        ${DB_PASSWORD}    ${SID}            multi_table_space.dmp     TEST,TEST1      ${EMPTY}    ${EMPTY}    NO          ${EMPTY}          ${EMPTY}                       YES          NO               ${EMPTY}          0                 NO          YES     NO        NONE          YES         YES            YES       YES         NO            NO                0         NO           User USERNAME (USERID), Session SESSIONID, Instance INSTANCEID    7200                                                              YES          0              ${ENDED_OK}

Export DB to txt file
                      ${DB_USERNAME2}                                        ${DB_PASSWORD}    ${SID}            export11.txt              ${EMPTY}        ${EMPTY}    ${EMPTY}    NO          test              ${EMPTY}                       NO           NO               ${EMPTY}          0                 NO          YES     NO        ESTIMATE      YES         YES            YES       YES         NO            NO                0         NO           User USERNAME (USERID), Session SESSIONID, Instance INSTANCEID    7200                                                              YES          0              ${ENDED_OK}

Export DB to .log file
                      ${DB_USERNAME}                                         ${DB_PASSWORD}    ${SID}            export12.log              ${EMPTY}        ${EMPTY}    ${EMPTY}    NO          ${EMPTY}          CERTIFICATE,TEST_FOR_IMPORT    NO           NO               ${EMPTY}          0                 NO          YES     NO        ESTIMATE      YES         YES            YES       YES         NO            NO                0         NO           User USERNAME (USERID), Session SESSIONID, Instance INSTANCEID    7200                                                              NO           0              ${ENDED_OK}

Export grants in case full export
                      ${DB_USERNAME2}                                        ${DB_PASSWORD}    ${SID}            export13.dmp              ${EMPTY}        ${EMPTY}    ${EMPTY}    YES         ${EMPTY}          ${EMPTY}                       NO           NO               testExport.log    2048              NO          YES     NO        ESTIMATE      YES         YES            YES       YES         NO            NO                2048      NO           User USERNAME (USERID), Session SESSIONID, Instance INSTANCEID    7200                                                              YES          0              ${ENDED_OK}

Export grants in case user export
                      ${DB_USERNAME}                                         ${DB_PASSWORD}    ${SID}            export14.dmp              ${EMPTY}        4MB         ${EMPTY}    NO          ${EMPTY}          CERTIFICATE                    NO           NO               testExport.log    2048              NO          YES     NO        ESTIMATE      YES         YES            YES       YES         NO            NO                2048      NO           User USERNAME (USERID), Session SESSIONID, Instance INSTANCEID    7200                                                              NO           0              ${ENDED_OK}

Not export triggers, not indexes
                      ${DB_USERNAME}                                         ${DB_PASSWORD}    ${SID}            export15.dmp              ${EMPTY}        4MB         ${EMPTY}    NO          ${EMPTY}          CERTIFICATE                    NO           NO               testExport.log    2048              NO          YES     NO        ESTIMATE      NO          YES            YES       NO          NO            NO                2048      NO           User USERNAME (USERID), Session SESSIONID, Instance INSTANCEID    7200                                                              NO           0              ${ENDED_OK}

Not export triggers, not indexes, not constraints
                      ${DB_USERNAME}                                         ${DB_PASSWORD}    ${SID}            export16.dmp              ${EMPTY}        4MB         ${EMPTY}    NO          ${EMPTY}          CERTIFICATE                    NO           NO               testExport.log    2048              NO          YES     NO        ESTIMATE      NO          NO             YES       NO          NO            NO                2048      NO           User USERNAME (USERID), Session SESSIONID, Instance INSTANCEID    7200                                                              NO           0              ${ENDED_OK}

Not export triggers, not indexes, not constraints, not grant
                      ${DB_USERNAME}                                         ${DB_PASSWORD}    ${SID}            export17.dmp              ${EMPTY}        4MB         ${EMPTY}    NO          ${DB_USERNAME}    ${EMPTY}                       NO           NO               testExport.log    2048              NO          YES     NO        ESTIMATE      NO          NO             YES       NO          NO            NO                2048      NO           User USERNAME (USERID), Session SESSIONID, Instance INSTANCEID    7200                                                              NO           0              ${ENDED_OK}

Check consistent, object consistent
                      ${DB_USERNAME}                                         ${DB_PASSWORD}    ${SID}            export4.dmp               ${EMPTY}        ${EMPTY}    ${EMPTY}    NO          ${EMPTY}          TEST_FOR_IMPORT                NO           YES              ${EMPTY}          0                 NO          YES     NO        ESTIMATE      YES         YES            YES       YES         YES           YES               0         NO           User USERNAME (USERID), Session SESSIONID, Instance INSTANCEID    7200                                                              NO           0              ${ENDED_OK}

Export with resumable user
                      ${DB_USERNAME}                                         ${DB_PASSWORD}    ${SID}            export20.dmp              ${EMPTY}        ${EMPTY}    ${EMPTY}    NO          ${EMPTY}          TEST_FOR_IMPORT                NO           YES              ${EMPTY}          0                 NO          YES     NO        ESTIMATE      YES         YES            YES       YES         YES           YES               0         YES          test                                                              7200                                                              NO           0              ${ENDED_OK}

Export with resumable session
                      ${DB_USERNAME}                                         ${DB_PASSWORD}    ${SID}            export21.dmp              ${EMPTY}        ${EMPTY}    ${EMPTY}    NO          ${EMPTY}          TEST_FOR_IMPORT                NO           YES              ${EMPTY}          0                 NO          YES     NO        ESTIMATE      YES         YES            YES       YES         YES           YES               0         YES          automic                                                           100                                                               NO           0              ${ENDED_OK}

*** Keywords ***
Suite Setup User Assign Import
    Suite Setup
    #Create User    ${DB_USERNAME1}    NO    YES    NO    NO
    #Create Tablespace    TEST2
    #Create Tablespace    tablespace1
    #Assign Grant all system    ${DB_USERNAME1}    #${USER_TEST}

Drop user and tablespace
    Drop User    ${DB_USERNAME1}
    Drop TableSpace    TEST
    Drop TableSpace    tablespace1

Export Db Template
    [Arguments]    ${name}    ${password}    ${sid}    ${files}    ${ts_list}    ${filesize}
    ...    ${volsize}    ${full}    ${owner_list}    ${table_list}    ${transp_ts}    ${tts_fullcheck}
    ...    ${logfile}    ${record_length}    ${compress}    ${rows}    ${direct}    ${statistics}
    ...    ${indexes}    ${constraints}    ${grants}    ${triggers}    ${consistent}    ${obj_consistent}
    ...    ${buffer}    ${resumable}    ${resumable_name}    ${timeout}    ${asSYSDBA}    ${returnCode}
    ...    ${returnStatus}
    #Import DB    ${_WORKING_DIR}${/}export4.dmp    ${EMPTY}    ${EMPTY}    ${table_list}    ${owner_list}    ${ts_list}
    Init Action    ${ACTION_EXPORT_DB}
    Action Set Timeout    2000
    Action Set    ${PRT_EXPORT_DB_DB_USERNAME}    ${name}
    Action Set    ${PRT_EXPORT_DB_DB_PASSWORD}    ${password}
    Action Set    ${PRT_EXPORT_DB_DB_SID}    ${sid}
    Action Set    ${PRT_EXPORT_DB_DB_EXPOPT_FILES}    ${files}
    Action Set    ${PRT_EXPORT_DB_DB_EXPMODE_TS_LIST}    ${ts_list}
    Action Set    ${PRT_EXPORT_DB_DB_EXPOPT_FILESIZE}    ${filesize}
    Action Set    ${PRT_EXPORT_DB_DB_EXPOPT_VOLSIZE}    ${volsize}
    Action Set    ${PRT_EXPORT_DB_DB_EXPMODE_FULL}    ${full}
    Action Set    ${PRT_EXPORT_DB_DB_IMP_INVOKE_AS_SYSDBA}    ${asSYSDBA}
    Action Set    ${PRT_EXPORT_DB_DB_EXPMODE_OWNER_LIST}    ${owner_list}
    Action Set    ${PRT_EXPORT_DB_DB_EXPMODE_TABLE_LIST}    ${table_list}
    Action Set    ${PRT_EXPORT_DB_DB_EXPMODE_TRANSP_TS}    ${transp_ts}
    Action Set    ${PRT_EXPORT_DB_DB_EXPMODE_TTS_FULLCHECK}    ${tts_fullcheck}
    Action Set    ${PRT_EXPORT_DB_DB_EXPOPT_LOGFILE}    ${logfile}
    Action Set    ${PRT_EXPORT_DB_DB_EXPOPT_RECORDLENGTH}    ${record_length}
    Action Set    ${PRT_EXPORT_DB_DB_EXPOPT_COMPRESS}    ${compress}
    Action Set    ${PRT_EXPORT_DB_DB_EXPOPT_ROWS}    ${rows}
    Action Set    ${PRT_EXPORT_DB_DB_EXPOPT_DIRECT}    ${direct}
    Action Set    ${PRT_EXPORT_DB_DB_EXPOPT_STATISTICS}    ${statistics}
    Action Set    ${PRT_EXPORT_DB_DB_EXPOPT_INDEXES}    ${indexes}
    Action Set    ${PRT_EXPORT_DB_DB_EXPOPT_CONSTRAINTS}    ${constraints}
    Action Set    ${PRT_EXPORT_DB_DB_EXPOPT_GRANTS}    ${grants}
    Action Set    ${PRT_EXPORT_DB_DB_EXPOPT_TRIGGERS}    ${triggers}
    Action Set    ${PRT_EXPORT_DB_DB_EXPOPT_CONSISTENT}    ${consistent}
    Action Set    ${PRT_EXPORT_DB_DB_EXPOPT_OBJ_CONSISTENT}    ${obj_consistent}
    Action Set    ${PRT_EXPORT_DB_DB_EXPOPT_BUFFER}    ${buffer}
    Action Set    ${PRT_EXPORT_DB_DB_EXPOPT_RESUMABLE}    ${resumable}
    Action Set    ${PRT_EXPORT_DB_DB_EXPOPT_RESUMABLE_NAME}    ${resumable_name}
    Action Set    ${PRT_EXPORT_DB_DB_EXPOPT_RSMBL_TIMEOUT}    ${timeout}
    Action Execute
    Action Report Should Be Found
    Action Return Code Should Be    ${returnCode}
    Action Return Status Should Be    ${returnStatus}
