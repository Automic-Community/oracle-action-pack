*** Settings ***
Documentation     NOTE:
...               add note here
Suite Setup       Suite Setup
Force Tags        IMPORT_DB    win11    unix11    unix10
Default Tags      ALL
Test Template     Import Db Template
Resource          ../../resources/keywords.txt

*** Test Cases ***    DB_USERNAME        DB_PASSWORD       SID                FILES                                                          FROMUSERS          TOUSERS                                  TS_LIST          TRANSP_TS    FILESIZE         VOLSIZE     AS_SYSDBA           FULL      TABLES                  TTS_OWNERS    DATAFILES                              LOGFILE    RECORDLENGTH    ROWS    COMMIT    BUFFER    IGNORE_ERR    DESTROY    CONSTRAINTS    CONFIG    INST    GRANTS    STATISTICS    RESUMABLE    RESUMABLE_NAME                                                    RSMBL_TIMEOUT    COMPILE    RETURN CODE    STATUS
Import DB with a table
                      itpa               ${DB_PASSWORD}    ${SID_IMPORT}      ${_WORKING_DIR}${/}export_table.dmp                            ${EMPTY}           ${EMPTY}                                 ${EMPTY}         NO           ${EMPTY}         ${EMPTY}    NO                  NO        staff                   ${EMPTY}      ${EMPTY}                               NO         0               YES     NO        0         NO            NO         YES            YES       NO      YES       ALWAYS        NO           User USERNAME (USERID), Session SESSIONID, Instance INSTANCEID    7200             YES        0              ${ENDED_OK}
                      #[Teardown]        Exec Sqlplus      ${SERVICE_NAME}    itpa                                                           No                 drop table staff;

Import DB with multi table
                      itpa               ${DB_PASSWORD}    ${SID_IMPORT}      ${_WORKING_DIR}${/}export_multi_table.dmp                      ${EMPTY}           ${EMPTY}                                 ${EMPTY}         NO           ${EMPTY}         ${EMPTY}    NO                  NO        market,certificate      ${EMPTY}      ${EMPTY}                               NO         0               YES     NO        0         NO            NO         YES            YES       NO      YES       ALWAYS        NO           User USERNAME (USERID), Session SESSIONID, Instance INSTANCEID    7200             YES        0              ${ENDED_OK}
                      #[Teardown]        Exec Sqlplus      ${SERVICE_NAME}    itpa                                                           No                 @${_WORKING_DIR}${/}dropTableItpa.sql

Import DB from multi files
                      ${DB_USERNAME2}    ${DB_PASSWORD}    ${SID_IMPORT}      ${_WORKING_DIR}${/}multi1.dmp,${_WORKING_DIR}${/}multi2.dmp    ${DB_USERNAME1}    user_a                                   ${EMPTY}         NO           16KB             ${EMPTY}    YES                 NO        STAFF,CERTIFICATE       ${EMPTY}      ${EMPTY}                               NO         0               YES     NO        0         NO            NO         YES            YES       NO      YES       ALWAYS        NO           User USERNAME (USERID), Session SESSIONID, Instance INSTANCEID    7200             YES        0              ${ENDED_OK}

Full import DB        ${DB_USERNAME2}    ${DB_PASSWORD}    ${SID_IMPORT}      ${_WORKING_DIR}${/}fullExport.dmp                              ${EMPTY}           ${EMPTY}                                 ${EMPTY}         YES          ${EMPTY}         ${EMPTY}    YES                 YES       ${EMPTY}                ${EMPTY}      ${EMPTY}                               NO         0               YES     NO        0         NO            NO         YES            YES       NO      YES       ALWAYS        NO           User USERNAME (USERID), Session SESSIONID, Instance INSTANCEID    7200             YES        0              ${ENDED_OK}

Import DB from user to user
                      ${DB_USERNAME2}    ${DB_PASSWORD}    ${SID_IMPORT}      ${_WORKING_DIR}${/}multi_table_space.dmp                       test               user_a                                   ${EMPTY}         NO           ${EMPTY}         ${EMPTY}    YES                 NO        ${EMPTY}                ${EMPTY}      ${EMPTY}                               NO         0               YES     NO        0         NO            NO         YES            YES       NO      YES       ALWAYS        NO           User USERNAME (USERID), Session SESSIONID, Instance INSTANCEID    7200             YES        0              ${ENDED_OK}

Import DB from multi user to an user
                      ${DB_USERNAME2}    ${DB_PASSWORD}    ${SID_IMPORT}      ${_WORKING_DIR}${/}multi_table_space.dmp                       itpa,test          user_a                                   ${EMPTY}         NO           ${EMPTY}         ${EMPTY}    YES                 NO        ${EMPTY}                ${EMPTY}      ${EMPTY}                               NO         0               YES     NO        0         NO            NO         YES            YES       NO      YES       ALWAYS        NO           User USERNAME (USERID), Session SESSIONID, Instance INSTANCEID    7200             YES        0              ${ENDED_OK}

Import DB from an user to multi user
                      [Setup]            Run Keywords      Create User        user_b                                                         NO                 YES                                      NO               NO           ${SID_IMPORT}    AND         Assign Grant all    user_b    NO                      YES
                      ${DB_USERNAME2}    ${DB_PASSWORD}    ${SID_IMPORT}      ${_WORKING_DIR}${/}multi_table_space.dmp                       ${DB_USERNAME}     test                                     user_a,user_b    NO           ${EMPTY}         ${EMPTY}    YES                 NO        ${EMPTY}                ${EMPTY}      ${EMPTY}                               NO         0               YES     NO        0         NO            NO         YES            YES       NO      YES       ALWAYS        NO           User USERNAME (USERID), Session SESSIONID, Instance INSTANCEID    7200             YES        0              ${ENDED_OK}
                      [Teardown]         Drop User         user_b

Import DB table space
                      ${DB_USERNAME2}    ${DB_PASSWORD}    ${SID_IMPORT}      ${_WORKING_DIR}${/}table_space.dmp                             ${DB_USERNAME}     user_a                                   TEST             NO           ${EMPTY}         ${EMPTY}    YES                 NO        ${EMPTY}                ${EMPTY}      ${EMPTY}                               NO         0               YES     NO        0         NO            NO         YES            YES       NO      YES       NONE          NO           User USERNAME (USERID), Session SESSIONID, Instance INSTANCEID    7200             YES        0              ${ENDED_OK}

Import DB multi table space
                      ${DB_USERNAME2}    ${DB_PASSWORD}    ${SID_IMPORT}      ${_WORKING_DIR}${/}multi_table_space.dmp                       ${DB_USERNAME2}    user_a                                   TEST,TEST1       NO           ${EMPTY}         ${EMPTY}    YES                 NO        CERTIFICATE,students    ${EMPTY}      ${EMPTY}                               NO         0               YES     NO        0         NO            NO         YES            YES       NO      YES       ALWAYS        NO           User USERNAME (USERID), Session SESSIONID, Instance INSTANCEID    7200             YES        0              ${ENDED_OK}

Import DB data files
                      ${DB_USERNAME2}    ${DB_PASSWORD}    ${SID_IMPORT}      ${_WORKING_DIR}${/}table_space.dmp                             ${DB_USERNAME}     ${DB_USERNAME2}                          TEST             NO           ${EMPTY}         ${EMPTY}    YES                 NO        ${EMPTY}                ${EMPTY}      tbs_perm_01.dat.dbf                    YES        0               YES     NO        0         NO            NO         YES            YES       NO      YES       NONE          NO           User USERNAME (USERID), Session SESSIONID, Instance INSTANCEID    7200             YES        0              ${ENDED_OK}

Import DB multi data files
                      ${DB_USERNAME2}    ${DB_PASSWORD}    ${SID_IMPORT}      ${_WORKING_DIR}${/}multi_table_space.dmp \                     ${DB_USERNAME2}    user_a                                   ${EMPTY}         NO           ${EMPTY}         ${EMPTY}    YES                 NO        ${EMPTY}                ${EMPTY}      tbs_perm_01.dat.dbf,tbs_perm_02.dat    YES        0               YES     NO        0         NO            NO         YES            YES       NO      YES       ALWAYS        NO           User USERNAME (USERID), Session SESSIONID, Instance INSTANCEID    7200             YES        0              ${ENDED_OK}

Import DB, not import rows
                      ${DB_USERNAME2}    ${DB_PASSWORD}    ${SID_IMPORT}      ${_WORKING_DIR}${/}export1.dmp                                 ${DB_USERNAME2}    user_a                                   ${EMPTY}         NO           ${EMPTY}         ${EMPTY}    YES                 NO        STAFF,CERTIFICATE       ${EMPTY}      ${EMPTY}                               YES        0               NO      NO        0         NO            NO         YES            YES       NO      YES       ALWAYS        NO           User USERNAME (USERID), Session SESSIONID, Instance INSTANCEID    7200             YES        0              ${ENDED_OK}

*** Keywords ***
Import Db Template
    [Arguments]    ${name}    ${pass}    ${sid}    ${files}    ${from_users}    ${to_users}
    ...    ${to_list}    ${transp_ts}    ${file_size}    ${vol_size}    ${invoke_as_sysdba}    ${full}
    ...    ${tables}    ${tts_owners}    ${data_files}    ${log_file}    ${record_length}    ${rows}
    ...    ${commit}    ${buffer}    ${ignore_err}    ${destroy}    ${constraints}    ${config}
    ...    ${inst}    ${grants}    ${statistics}    ${resumable}    ${resumable_name}    ${timeout}
    ...    ${compile}    ${returnCode}    ${returnStatus}
    Create User    user_a    NO    YES    NO    NO    ${SID_IMPORT}
    Assign Grant all    user_a    NO    YES
    Init Action    ${ACTION_IMPORT_DB}
    Action Set Timeout    1500
    Action Set    ${PRT_IMPORT_DB_DB_USERNAME}    ${name}
    Action Set    ${PRT_IMPORT_DB_DB_PASSWORD}    ${pass}
    Action Set    ${PRT_IMPORT_DB_DB_SID}    ${sid}
    Action Set    ${PRT_IMPORT_DB_DB_IMPOPT_FILES}    ${files}
    Action Set    ${PRT_IMPORT_DB_DB_IMPMODE_FROMUSERS}    ${from_users}
    Action Set    ${PRT_IMPORT_DB_DB_IMPMODE_TOUSERS}    ${to_users}
    Action Set    ${PRT_IMPORT_DB_DB_IMPMODE_TS_LIST}    ${to_list}
    Action Set    ${PRT_IMPORT_DB_DB_IMPMODE_TRANSP_TS}    ${transp_ts}
    Action Set    ${PRT_IMPORT_DB_DB_IMPOPT_FILESIZE}    ${file_size}
    Action Set    ${PRT_IMPORT_DB_DB_IMPOPT_VOLSIZE}    ${vol_size}
    Action Set    ${PRT_IMPORT_DB_DB_IMP_INVOKE_AS_SYSDBA}    ${invoke_as_sysdba}
    Action Set    ${PRT_IMPORT_DB_DB_IMPMODE_FULL}    ${full}
    Action Set    ${PRT_IMPORT_DB_DB_IMPMODE_TABLES}    ${tables}
    Action Set    ${PRT_IMPORT_DB_DB_IMPMODE_TTS_OWNERS}    ${tts_owners}
    Action Set    ${PRT_IMPORT_DB_DB_IMPMODE_DATAFILES}    ${data_files}
    Action Set    ${PRT_IMPORT_DB_DB_IMPOPT_LOGFILE}    ${log_file}
    Action Set    ${PRT_IMPORT_DB_DB_IMPOPT_RECORDLENGTH}    ${record_length}
    Action Set    ${PRT_IMPORT_DB_DB_IMPOPT_ROWS}    ${rows}
    Action Set    ${PRT_IMPORT_DB_DB_IMPOPT_COMMIT}    ${commit}
    Action Set    ${PRT_IMPORT_DB_DB_IMPOPT_BUFFER}    ${buffer}
    Action Set    ${PRT_IMPORT_DB_DB_IMPOPT_IGNORE_ERR}    ${ignore_err}
    Action Set    ${PRT_IMPORT_DB_DB_IMPOPT_DESTROY}    ${destroy}
    Action Set    ${PRT_IMPORT_DB_DB_IMPOPT_CONSTRAINTS}    ${constraints}
    Action Set    ${PRT_IMPORT_DB_DB_IMPOPT_STREAMS_CONFIG}    ${config}
    Action Set    ${PRT_IMPORT_DB_DB_IMPOPT_STREAMS_INST}    ${inst}
    Action Set    ${PRT_IMPORT_DB_DB_IMPOPT_GRANTS}    ${grants}
    Action Set    ${PRT_IMPORT_DB_DB_IMPOPT_STATISTICS}    ${statistics}
    Action Set    ${PRT_IMPORT_DB_DB_IMPOPT_RESUMABLE}    ${resumable}
    Action Set    ${PRT_IMPORT_DB_DB_IMPOPT_RESUMABLE_NAME}    ${resumable_name}
    Action Set    ${PRT_IMPORT_DB_DB_IMPOPT_RSMBL_TIMEOUT}    ${timeout}
    Action Set    ${PRT_IMPORT_DB_DB_IMPOPT_COMPILE}    ${compile}
    Action Execute
    Action Report Should Be Found
    Action Return Code Should Be    ${returnCode}
    Action Return Status Should Be    ${returnStatus}
    [Teardown]    Drop User From Instance    USER_A    ${sid}
